{{ define "title" }}User management{{ end }}

{{ define "meta" }}
  <style>
    #_user_table {
      .username {
        width: 100%;
      }

      th {
        white-space: nowrap;
      }
    }
  </style>
{{ end }}

{{ define "content" }}
  <header class="h">
    <nav class="breadcrumbs">
      <a href="/admin">Admin</a>
      <a href="/admin/users">User management</a>
    </nav>
  </header>

  <section class="v gap-2">
    <div class="v paper table-container">
      <table id="_user_table" class="data padding">
        <thead>
          <tr>
            <th class="username">Username</th>
            <th>Last login</th>
            <th>Last activity</th>
            <th>Sessions</th>
            <th>Invites</th>
          </tr>
        </thead>
        <tbody>
          {{ range .Users }}
            <tr>
              <td class="username">
                <strong>
                  <a href="/admin/users/{{ .UserId }}" class="link"
                    >{{ .Username }}</a
                  >
                </strong>
              </td>
              <td>
                {{ if .LastLogin.IsZero }}
                  -
                {{ else }}
                  <time datetime="{{ .LastLogin }}" title="{{ .LastLogin }}"
                    >{{ .LastLogin | date "2006-01-02 15:04:05" }}
                  </time>
                {{ end }}
              </td>
              <td>
                {{ if .LastActivity.IsZero }}
                  -
                {{ else }}
                  <time
                    datetime="{{ .LastActivity }}"
                    title="{{ .LastActivity }}"
                    >{{ .LastActivity | date "2006-01-02 15:04:05" }}
                  </time>
                {{ end }}
              </td>
              <td>
                <span class="session-count">{{ .SessionCount }}</span>
                <button
                  class="link"
                  hx-post="/admin/users/{{ .UserId }}/end-all-sessions"
                  hx-confirm="End all sessions and require '{{ .Username }}' to login again? It may take a few minutes until all sessions are ended."
                  hx-target="previous .session-count"
                >
                  End all
                </button>
              </td>
              <td>
                {{ if eq .InvitesRemaining -1 }}
                  <span class="invites-remaining">âˆž</span>
                {{ else }}
                  <span class="invites-remaining">{{ .InvitesRemaining }}</span>
                  <button
                    class="link"
                    hx-put="/admin/users/{{ .UserId }}/invites?to=5"
                    hx-target="previous .invites-remaining"
                  >
                    Refill
                  </button>
                  /
                  <button
                    class="link"
                    hx-put="/admin/users/{{ .UserId }}/invites"
                    hx-target="previous .invites-remaining"
                  >
                    Clear
                  </button>
                {{ end }}
              </td>
            </tr>
          {{ end }}
        </tbody>
      </table>
    </div>
    <div class="h justify-end gap-1">
      <a
        class="button contrast-medium"
        {{ if .CanCreateUsers }}
          href="/admin/users/create"
        {{ else }}
          disabled title="No invites remaining"
        {{ end }}
        >Create User</a
      >
    </div>
  </section>
{{ end }}

{{ template "layout/main.html" . }}
